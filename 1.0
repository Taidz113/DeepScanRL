-- ============================================================
--  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
--  â•‘        DungeonX DEEP SPY TOOL v2.0                    â•‘
--  â•‘        Advanced Security Research Tool                 â•‘
--  â•‘        Made by HCT                                     â•‘
--  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--
--  Má»¥c Ä‘Ã­ch: PhÃ¢n tÃ­ch báº£o máº­t game Roblox cÃ¡ nhÃ¢n
--  Ká»¹ thuáº­t: Metamethod Hooking, GC Scanning, 
--            Upvalue/Constant Extraction, Deep Serialization
-- ============================================================

-- ====================== ANTI DUPLICATE ======================
local Player = game:GetService("Players").LocalPlayer
if Player.PlayerGui:FindFirstChild("DX_DeepSpy") then
    Player.PlayerGui.DX_DeepSpy:Destroy()
    task.wait(0.3)
end

-- ====================== SERVICES ======================
local Players          = game:GetService("Players")
local RunService       = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService     = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui       = game:GetService("StarterGui")
local HttpService      = game:GetService("HttpService")
local Workspace        = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- ====================== EXECUTOR FUNCTION CHECK ======================
local function CheckFunction(name, fallback)
    local env = getgenv and getgenv() or _G
    local fn = env[name] or getfenv()[name] or rawget(_G, name)
    if fn and type(fn) == "function" then return fn end
    if fallback then return fallback end
    return function(...) 
        warn("[DX Deep Spy] " .. name .. " khÃ´ng kháº£ dá»¥ng trÃªn executor nÃ y") 
        return nil 
    end
end

-- Executor functions
local hookmetamethod    = CheckFunction("hookmetamethod")
local getnamecallmethod = CheckFunction("getnamecallmethod")
local newcclosure       = CheckFunction("newcclosure", function(f) return f end)
local checkcaller       = CheckFunction("checkcaller", function() return false end)
local getgc             = CheckFunction("getgc", function() return {} end)
local getupvalues       = CheckFunction("debug.getupvalues") or (debug and debug.getupvalues) or function() return {} end
local getconstants      = CheckFunction("debug.getconstants") or (debug and debug.getconstants) or function() return {} end
local getinfo           = CheckFunction("debug.getinfo") or (debug and debug.getinfo) or function() return {} end
local getstack          = CheckFunction("debug.getstack") or (debug and debug.getstack) or function() return nil end
local setclipboard      = CheckFunction("setclipboard") or CheckFunction("toclipboard")
local getnilinstances   = CheckFunction("getnilinstances", function() return {} end)
local getloadedmodules  = CheckFunction("getloadedmodules", function() return {} end)
local getscripts        = CheckFunction("getscripts", function() return {} end)
local iscclosure        = CheckFunction("iscclosure", function() return false end)
local islclosure        = CheckFunction("islclosure", function() return true end)
local getrawmetatable   = CheckFunction("getrawmetatable", function(t) return getmetatable(t) end)
local hookfunction      = CheckFunction("hookfunction")
local getcallingscript  = CheckFunction("getcallingscript", function() return nil end)

-- Safe debug wrappers
local function SafeGetUpvalues(fn)
    local ok, result = pcall(function()
        if debug and debug.getupvalues then
            return debug.getupvalues(fn)
        elseif getupvalues then
            return getupvalues(fn)
        end
        return {}
    end)
    return ok and result or {}
end

local function SafeGetConstants(fn)
    local ok, result = pcall(function()
        if debug and debug.getconstants then
            return debug.getconstants(fn)
        elseif getconstants then
            return getconstants(fn)
        end
        return {}
    end)
    return ok and result or {}
end

local function SafeGetInfo(fn)
    local ok, result = pcall(function()
        if debug and debug.getinfo then
            return debug.getinfo(fn)
        elseif getinfo then
            return getinfo(fn)
        end
        return {}
    end)
    return ok and result or {}
end

-- ====================== DATA STORAGE ======================
local SpyState = {
    -- Logs
    RemoteLogs     = {},
    GCScanResults  = {},
    NilInstances   = {},
    HiddenRemotes  = {},
    DeepScanData   = {},
    CallStacks     = {},
    
    -- Counters
    TotalCaught    = 0,
    EventCount     = 0,
    FuncCount      = 0,
    HiddenCount    = 0,
    
    -- Flags
    IsRecording    = false,
    IsDeepScanning = false,
    
    -- Hooks
    Hooks          = {},
    OldNamecall    = nil,
    OldIndex       = nil,
    
    -- Filters
    FilterKeywords = {},
    BlockList      = {}, -- Ignore noisy remotes
    
    -- Capability flags
    HasHookMeta    = hookmetamethod ~= nil and type(hookmetamethod) == "function",
    HasGetGC       = getgc ~= nil and type(getgc) == "function",
    HasDebug       = debug ~= nil and debug.getupvalues ~= nil,
    HasNilInst     = getnilinstances ~= nil and type(getnilinstances) == "function",
}

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘          DEEP SERIALIZATION ENGINE                       â•‘
-- â•‘  Giáº£i mÃ£ má»i kiá»ƒu dá»¯ liá»‡u thÃ nh string Ä‘á»c Ä‘Æ°á»£c       â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Serializer = {}
Serializer.MaxDepth = 10
Serializer.MaxStringLen = 500
Serializer.SeenTables = {}

function Serializer.Reset()
    Serializer.SeenTables = {}
end

function Serializer.Serialize(value, depth, indent)
    depth = depth or 0
    indent = indent or ""
    
    if depth > Serializer.MaxDepth then
        return indent .. "-- [MAX DEPTH REACHED] --"
    end
    
    local valueType = typeof(value)
    
    -- â•â•â• NIL â•â•â•
    if valueType == "nil" then
        return "nil"
    
    -- â•â•â• BOOLEAN â•â•â•
    elseif valueType == "boolean" then
        return tostring(value)
    
    -- â•â•â• NUMBER â•â•â•
    elseif valueType == "number" then
        if value == math.huge then return "math.huge"
        elseif value == -math.huge then return "-math.huge"
        elseif value ~= value then return "0/0 --[[NaN]]"
        elseif value == math.floor(value) then return string.format("%d", value)
        else return string.format("%.6f", value)
        end
    
    -- â•â•â• STRING â•â•â•
    elseif valueType == "string" then
        if #value > Serializer.MaxStringLen then
            return '"' .. value:sub(1, Serializer.MaxStringLen):gsub('[%c\\"]', {
                ["\n"] = "\\n", ["\r"] = "\\r", ["\t"] = "\\t",
                ["\\"] = "\\\\", ['"'] = '\\"'
            }) .. '..." --[[truncated, len=' .. #value .. ']]'
        end
        return '"' .. value:gsub('[%c\\"]', {
            ["\n"] = "\\n", ["\r"] = "\\r", ["\t"] = "\\t",
            ["\\"] = "\\\\", ['"'] = '\\"'
        }) .. '"'
    
    -- â•â•â• INSTANCE â•â•â•
    elseif valueType == "Instance" then
        local path = value:GetFullName()
        local className = value.ClassName
        local extra = ""
        
        if value:IsA("RemoteEvent") or value:IsA("RemoteFunction") then
            extra = " â­[REMOTE]"
        elseif value:IsA("Tool") then
            extra = " ğŸ”§[TOOL]"
        elseif value:IsA("Humanoid") then
            pcall(function()
                extra = string.format(" ğŸ‘¤[HP:%.0f/%.0f]", value.Health, value.MaxHealth)
            end)
        end
        
        return string.format('game:GetService("Players").LocalPlayer -- Instance: %s [%s]%s',
            path, className, extra)
    
    -- â•â•â• VECTOR3 â•â•â•
    elseif valueType == "Vector3" then
        return string.format("Vector3.new(%.2f, %.2f, %.2f)", value.X, value.Y, value.Z)
    
    -- â•â•â• CFRAME â•â•â•
    elseif valueType == "CFrame" then
        local p = value.Position
        local lv = value.LookVector
        return string.format(
            "CFrame.new(%.2f, %.2f, %.2f) --[[LookVector: %.2f, %.2f, %.2f]]",
            p.X, p.Y, p.Z, lv.X, lv.Y, lv.Z
        )
    
    -- â•â•â• COLOR3 â•â•â•
    elseif valueType == "Color3" then
        return string.format("Color3.fromRGB(%d, %d, %d)", 
            math.floor(value.R * 255), math.floor(value.G * 255), math.floor(value.B * 255))
    
    -- â•â•â• UDIM2 â•â•â•
    elseif valueType == "UDim2" then
        return string.format("UDim2.new(%.3f, %d, %.3f, %d)", 
            value.X.Scale, value.X.Offset, value.Y.Scale, value.Y.Offset)
    
    -- â•â•â• ENUM â•â•â•
    elseif valueType == "EnumItem" then
        return tostring(value)
    
    -- â•â•â• RAY â•â•â•
    elseif valueType == "Ray" then
        local o, d = value.Origin, value.Direction
        return string.format("Ray.new(Vector3.new(%.2f,%.2f,%.2f), Vector3.new(%.2f,%.2f,%.2f))",
            o.X, o.Y, o.Z, d.X, d.Y, d.Z)
    
    -- â•â•â• VECTOR2 â•â•â•
    elseif valueType == "Vector2" then
        return string.format("Vector2.new(%.2f, %.2f)", value.X, value.Y)
    
    -- â•â•â• FUNCTION â•â•â•
    elseif valueType == "function" then
        local info = SafeGetInfo(value)
        local src = info and info.source or "unknown"
        local line = info and info.currentline or "?"
        local isCClosure = pcall(function() return iscclosure(value) end) and iscclosure(value)
        return string.format("function() --[[%s, source: %s:%s]]", 
            isCClosure and "C closure" or "Lua closure", tostring(src), tostring(line))
    
    -- â•â•â• TABLE (Äá»† QUY SÃ‚U) â•â•â•
    elseif valueType == "table" then
        -- Check circular reference
        if Serializer.SeenTables[value] then
            return "--[[CIRCULAR REF]]"
        end
        Serializer.SeenTables[value] = true
        
        local count = 0
        for _ in pairs(value) do count = count + 1 end
        
        if count == 0 then
            Serializer.SeenTables[value] = nil
            return "{}"
        end
        
        if count > 100 then
            Serializer.SeenTables[value] = nil
            return "{--[[" .. count .. " entries, too large]]}"
        end
        
        local newIndent = indent .. "    "
        local parts = {}
        
        -- Check if array-like
        local isArray = true
        local maxN = 0
        for k, _ in pairs(value) do
            if type(k) ~= "number" or k < 1 or k ~= math.floor(k) then
                isArray = false
                break
            end
            if k > maxN then maxN = k end
        end
        if maxN ~= count then isArray = false end
        
        if isArray then
            for i = 1, count do
                local serialized = Serializer.Serialize(value[i], depth + 1, newIndent)
                table.insert(parts, newIndent .. serialized)
            end
        else
            -- Sort keys for readability
            local keys = {}
            for k in pairs(value) do table.insert(keys, k) end
            table.sort(keys, function(a, b)
                if type(a) == type(b) then
                    if type(a) == "string" then return a < b end
                    if type(a) == "number" then return a < b end
                end
                return tostring(a) < tostring(b)
            end)
            
            for _, k in ipairs(keys) do
                local keyStr
                if type(k) == "string" and k:match("^[%a_][%w_]*$") then
                    keyStr = k
                else
                    keyStr = "[" .. Serializer.Serialize(k, depth + 1) .. "]"
                end
                
                local valStr = Serializer.Serialize(value[k], depth + 1, newIndent)
                table.insert(parts, newIndent .. keyStr .. " = " .. valStr)
            end
        end
        
        Serializer.SeenTables[value] = nil
        return "{\n" .. table.concat(parts, ",\n") .. "\n" .. indent .. "}"
    
    -- â•â•â• USERDATA / UNKNOWN â•â•â•
    else
        return string.format("--[[%s: %s]]", valueType, tostring(value))
    end
end

function Serializer.SerializeArgs(args)
    Serializer.Reset()
    if not args or #args == 0 then return "()" end
    
    local parts = {}
    for i, arg in ipairs(args) do
        table.insert(parts, string.format("\n    [%d] = %s", i, Serializer.Serialize(arg, 1, "    ")))
    end
    return "(" .. table.concat(parts, ",") .. "\n)"
end

function Serializer.SerializeCompact(value, depth)
    depth = depth or 0
    if depth > 5 then return "..." end
    
    local t = typeof(value)
    if t == "nil" then return "nil"
    elseif t == "boolean" then return tostring(value)
    elseif t == "number" then return tostring(value)
    elseif t == "string" then return '"' .. value:sub(1, 80) .. '"'
    elseif t == "Instance" then return value:GetFullName()
    elseif t == "Vector3" then return string.format("V3(%.1f,%.1f,%.1f)", value.X, value.Y, value.Z)
    elseif t == "CFrame" then return string.format("CF(%.1f,%.1f,%.1f)", value.Position.X, value.Position.Y, value.Position.Z)
    elseif t == "table" then
        local parts = {}
        local c = 0
        for k, v in pairs(value) do
            c = c + 1
            if c > 5 then table.insert(parts, "...") break end
            table.insert(parts, tostring(k) .. "=" .. Serializer.SerializeCompact(v, depth + 1))
        end
        return "{" .. table.concat(parts, ", ") .. "}"
    else return tostring(value)
    end
end

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘          CALLSTACK TRACER                                â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function GetCallStack()
    local stack = {}
    local level = 2
    
    while level < 15 do
        local ok, info = pcall(function()
            if debug and debug.info then
                local src, name, line = debug.info(level, "snl")
                return {source = src, name = name, line = line}
            elseif debug and debug.getinfo then
                return debug.getinfo(level)
            end
            return nil
        end)
        
        if not ok or not info then break end
        
        local entry = string.format(
            "  [%d] %s @ %s:%s",
            level - 1,
            tostring(info.name or "anonymous"),
            tostring(info.source or "?"),
            tostring(info.line or info.currentline or "?")
        )
        table.insert(stack, entry)
        level = level + 1
    end
    
    -- Also try getcallingscript
    local callingScript = nil
    pcall(function()
        callingScript = getcallingscript()
    end)
    
    if callingScript then
        table.insert(stack, 1, "  [CallingScript] " .. callingScript:GetFullName())
    end
    
    if #stack == 0 then
        return {"  [No stack info available]"}
    end
    
    return stack
end

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘          UPVALUE & CONSTANT EXTRACTOR                    â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function ExtractFunctionData(fn)
    local data = {
        upvalues = {},
        constants = {},
        info = {},
    }
    
    -- Get upvalues
    pcall(function()
        local upvals = SafeGetUpvalues(fn)
        if upvals then
            for idx, val in pairs(upvals) do
                data.upvalues[idx] = {
                    type = typeof(val),
                    value = Serializer.SerializeCompact(val, 0),
                    raw = val,
                }
                
                -- Náº¿u upvalue lÃ  Instance Remote â†’ Ä‘Ã¡nh dáº¥u Ä‘áº·c biá»‡t
                if typeof(val) == "Instance" then
                    if val:IsA("RemoteEvent") or val:IsA("RemoteFunction") then
                        data.upvalues[idx].tag = "â­ HIDDEN REMOTE"
                    end
                end
            end
        end
    end)
    
    -- Get constants
    pcall(function()
        local consts = SafeGetConstants(fn)
        if consts then
            for idx, val in pairs(consts) do
                if val ~= nil then
                    data.constants[idx] = {
                        type = type(val),
                        value = tostring(val),
                    }
                end
            end
        end
    end)
    
    -- Get info
    pcall(function()
        data.info = SafeGetInfo(fn)
    end)
    
    return data
end

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘          GC SCANNER (GARBAGE COLLECTOR)                  â•‘
-- â•‘  QuÃ©t bá»™ nhá»› tÃ¬m Remote áº©n                             â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local GCScanner = {}

function GCScanner.ScanForRemotes()
    local results = {
        functions_with_remotes = {},
        tables_with_remotes = {},
        hidden_remotes = {},
        remote_keywords = {},
        total_scanned = 0,
    }
    
    local gc = getgc(true) -- true = include tables
    results.total_scanned = #gc
    
    local remoteKeywords = {
        "fire", "server", "remote", "event", "invoke",
        "request", "send", "network", "replicate",
        "attack", "damage", "skill", "raid", "equip",
        "teleport", "move", "action", "use", "activate",
        "room", "ope", "kioru", "fruit", "dodge",
        "buy", "sell", "trade", "quest", "reward",
    }
    
    for _, obj in ipairs(gc) do
        -- â•â•â• SCAN FUNCTIONS â•â•â•
        if type(obj) == "function" and not iscclosure(obj) then
            pcall(function()
                local upvals = SafeGetUpvalues(obj)
                local consts = SafeGetConstants(obj)
                
                -- Check upvalues for Remote instances
                if upvals then
                    for idx, val in pairs(upvals) do
                        if typeof(val) == "Instance" then
                            if val:IsA("RemoteEvent") or val:IsA("RemoteFunction") then
                                table.insert(results.functions_with_remotes, {
                                    type = "upvalue_remote",
                                    functionInfo = SafeGetInfo(obj),
                                    upvalueIndex = idx,
                                    remoteName = val.Name,
                                    remotePath = val:GetFullName(),
                                    remoteClass = val.ClassName,
                                    allUpvalues = upvals,
                                    allConstants = consts,
                                })
                            end
                        end
                    end
                end
                
                -- Check constants for remote-related keywords
                if consts then
                    for idx, val in pairs(consts) do
                        if type(val) == "string" then
                            local lower = val:lower()
                            for _, keyword in ipairs(remoteKeywords) do
                                if lower:find(keyword) then
                                    table.insert(results.remote_keywords, {
                                        type = "keyword_match",
                                        keyword = keyword,
                                        constant = val,
                                        constantIndex = idx,
                                        functionInfo = SafeGetInfo(obj),
                                    })
                                    break
                                end
                            end
                        end
                    end
                end
            end)
        
        -- â•â•â• SCAN TABLES â•â•â•
        elseif type(obj) == "table" then
            pcall(function()
                for k, v in pairs(obj) do
                    if typeof(v) == "Instance" then
                        if v:IsA("RemoteEvent") or v:IsA("RemoteFunction") then
                            table.insert(results.tables_with_remotes, {
                                type = "table_remote",
                                key = tostring(k),
                                remoteName = v.Name,
                                remotePath = v:GetFullName(),
                                remoteClass = v.ClassName,
                            })
                        end
                    end
                end
            end)
        end
    end
    
    return results
end

function GCScanner.ScanNilInstances()
    local results = {}
    
    local nilInsts = getnilinstances()
    for _, inst in ipairs(nilInsts) do
        pcall(function()
            if inst:IsA("RemoteEvent") or inst:IsA("RemoteFunction") then
                table.insert(results, {
                    type = "nil_remote",
                    name = inst.Name,
                    className = inst.ClassName,
                    fullName = inst:GetFullName(),
                    parent = inst.Parent and inst.Parent:GetFullName() or "nil",
                    instance = inst,
                })
            end
        end)
    end
    
    return results
end

function GCScanner.ScanHiddenModules()
    local results = {}
    
    local modules = getloadedmodules()
    for _, mod in ipairs(modules) do
        pcall(function()
            local name = mod.Name:lower()
            local remoteKeywords = {"remote", "network", "fire", "server", "event", "combat", "skill", "raid"}
            
            for _, kw in ipairs(remoteKeywords) do
                if name:find(kw) then
                    table.insert(results, {
                        type = "module",
                        name = mod.Name,
                        path = mod:GetFullName(),
                        keyword = kw,
                    })
                    break
                end
            end
        end)
    end
    
    return results
end

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘                     UI SYSTEM                            â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local C = {
    BG          = Color3.fromRGB(8, 8, 10),
    Surface     = Color3.fromRGB(14, 14, 16),
    Card        = Color3.fromRGB(20, 20, 22),
    CardHover   = Color3.fromRGB(28, 28, 32),
    Border      = Color3.fromRGB(35, 35, 40),
    White       = Color3.fromRGB(255, 255, 255),
    WhiteDim    = Color3.fromRGB(190, 190, 190),
    Gray        = Color3.fromRGB(120, 120, 130),
    GrayDark    = Color3.fromRGB(60, 60, 70),
    Green       = Color3.fromRGB(80, 255, 120),
    GreenDark   = Color3.fromRGB(40, 180, 80),
    Red         = Color3.fromRGB(255, 75, 75),
    Yellow      = Color3.fromRGB(255, 220, 80),
    Blue        = Color3.fromRGB(90, 150, 255),
    Purple      = Color3.fromRGB(175, 120, 255),
    Cyan        = Color3.fromRGB(80, 210, 255),
    Orange      = Color3.fromRGB(255, 160, 60),
    Pink        = Color3.fromRGB(255, 100, 180),
}

local function Tw(obj, props, dur)
    if not obj or not obj.Parent then return end
    TweenService:Create(obj, TweenInfo.new(dur or 0.2, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), props):Play()
end

local function Crn(p, r)
    local c = Instance.new("UICorner"); c.CornerRadius = UDim.new(0, r or 6); c.Parent = p
end

local function Pd(p, t, b, l, r)
    local pd = Instance.new("UIPadding")
    pd.PaddingTop = UDim.new(0, t or 0); pd.PaddingBottom = UDim.new(0, b or 0)
    pd.PaddingLeft = UDim.new(0, l or 0); pd.PaddingRight = UDim.new(0, r or 0)
    pd.Parent = p
end

local function Strk(p, col, th)
    local s = Instance.new("UIStroke")
    s.Color = col or C.Border; s.Thickness = th or 1
    s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border; s.Parent = p
end

local function Notify(text, dur)
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = "DX Deep Spy", Text = text, Duration = dur or 3
        })
    end)
end

-- ==================== MAIN GUI ====================
local GUI = Instance.new("ScreenGui")
GUI.Name = "DX_DeepSpy"
GUI.ResetOnSpawn = false
GUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
GUI.Parent = LocalPlayer.PlayerGui

local Main = Instance.new("Frame")
Main.Size = UDim2.new(0, 700, 0, 500)
Main.Position = UDim2.new(0.5, -350, 0.5, -250)
Main.BackgroundColor3 = C.BG
Main.BorderSizePixel = 0
Main.ClipsDescendants = true
Main.Parent = GUI
Crn(Main, 10)
Strk(Main, C.Border, 1)

-- Intro
Main.Size = UDim2.new(0, 700, 0, 0)
Main.Position = UDim2.new(0.5, -350, 0.5, 0)
Main.BackgroundTransparency = 1
task.delay(0.1, function()
    Tw(Main, {
        Size = UDim2.new(0, 700, 0, 500),
        Position = UDim2.new(0.5, -350, 0.5, -250),
        BackgroundTransparency = 0,
    }, 0.5)
end)

-- ==================== TITLE BAR ====================
local TBar = Instance.new("Frame")
TBar.Size = UDim2.new(1, 0, 0, 38)
TBar.BackgroundColor3 = C.Surface
TBar.BorderSizePixel = 0
TBar.Parent = Main

local TBarFix = Instance.new("Frame")
TBarFix.Size = UDim2.new(1, 0, 0, 10)
TBarFix.Position = UDim2.new(0, 0, 1, -10)
TBarFix.BackgroundColor3 = C.Surface
TBarFix.BorderSizePixel = 0
TBarFix.Parent = TBar

local TitleLbl = Instance.new("TextLabel")
TitleLbl.Size = UDim2.new(0, 400, 1, 0)
TitleLbl.Position = UDim2.new(0, 12, 0, 0)
TitleLbl.BackgroundTransparency = 1
TitleLbl.Text = "ğŸ”¬ DungeonX Deep Spy"
TitleLbl.TextSize = 15
TitleLbl.Font = Enum.Font.GothamBlack
TitleLbl.TextColor3 = C.White
TitleLbl.TextXAlignment = Enum.TextXAlignment.Left
TitleLbl.Parent = TBar

local SubLbl = Instance.new("TextLabel")
SubLbl.Size = UDim2.new(0, 250, 1, 0)
SubLbl.Position = UDim2.new(0, 200, 0, 1)
SubLbl.BackgroundTransparency = 1
SubLbl.Text = "/ Advanced Security Research Tool v2.0"
SubLbl.TextSize = 9
SubLbl.Font = Enum.Font.GothamMedium
SubLbl.TextColor3 = C.GrayDark
SubLbl.TextXAlignment = Enum.TextXAlignment.Left
SubLbl.Parent = TBar

-- Capability badges
local CapFrame = Instance.new("Frame")
CapFrame.Size = UDim2.new(0, 250, 0, 16)
CapFrame.Position = UDim2.new(1, -380, 0, 11)
CapFrame.BackgroundTransparency = 1
CapFrame.Parent = TBar

local CapLayout = Instance.new("UIListLayout")
CapLayout.FillDirection = Enum.FillDirection.Horizontal
CapLayout.Padding = UDim.new(0, 4)
CapLayout.Parent = CapFrame

local function CapBadge(text, available)
    local b = Instance.new("TextLabel")
    b.Size = UDim2.new(0, 60, 0, 16)
    b.BackgroundColor3 = available and C.GreenDark or Color3.fromRGB(80, 30, 30)
    b.Text = text
    b.TextSize = 7
    b.Font = Enum.Font.GothamBold
    b.TextColor3 = available and C.Green or C.Red
    b.Parent = CapFrame
    Crn(b, 3)
end

CapBadge("HOOK", SpyState.HasHookMeta)
CapBadge("GC", SpyState.HasGetGC)
CapBadge("DEBUG", SpyState.HasDebug)
CapBadge("NIL", SpyState.HasNilInst)

-- Close & Minimize
local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 38, 0, 38)
CloseBtn.Position = UDim2.new(1, -38, 0, 0)
CloseBtn.BackgroundTransparency = 1
CloseBtn.Text = "âœ•"
CloseBtn.TextSize = 14
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextColor3 = C.GrayDark
CloseBtn.Parent = TBar
CloseBtn.MouseEnter:Connect(function() Tw(CloseBtn, {TextColor3 = C.Red}, 0.1) end)
CloseBtn.MouseLeave:Connect(function() Tw(CloseBtn, {TextColor3 = C.GrayDark}, 0.1) end)
CloseBtn.MouseButton1Click:Connect(function()
    SpyState.IsRecording = false
    Tw(Main, {Size = UDim2.new(0, 700, 0, 0), BackgroundTransparency = 1}, 0.3)
    task.wait(0.35)
    GUI:Destroy()
end)

local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 38, 0, 38)
MinBtn.Position = UDim2.new(1, -72, 0, 0)
MinBtn.BackgroundTransparency = 1
MinBtn.Text = "â”€"
MinBtn.TextSize = 14
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextColor3 = C.GrayDark
MinBtn.Parent = TBar

local isMin = false
MinBtn.MouseButton1Click:Connect(function()
    isMin = not isMin
    Tw(Main, {Size = isMin and UDim2.new(0, 700, 0, 38) or UDim2.new(0, 700, 0, 500)}, 0.3)
end)

-- Drag
do
    local d, di, ds, sp
    TBar.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            d = true; ds = i.Position; sp = Main.Position
            i.Changed:Connect(function() if i.UserInputState == Enum.UserInputState.End then d = false end end)
        end
    end)
    TBar.InputChanged:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseMovement then di = i end
    end)
    UserInputService.InputChanged:Connect(function(i)
        if i == di and d then
            local delta = i.Position - ds
            Main.Position = UDim2.new(sp.X.Scale, sp.X.Offset + delta.X, sp.Y.Scale, sp.Y.Offset + delta.Y)
        end
    end)
end

-- Separator
local Sep = Instance.new("Frame")
Sep.Size = UDim2.new(1, 0, 0, 1)
Sep.Position = UDim2.new(0, 0, 0, 38)
Sep.BackgroundColor3 = C.Border
Sep.BorderSizePixel = 0
Sep.Parent = Main

-- ==================== TAB BAR ====================
local TabBar = Instance.new("Frame")
TabBar.Size = UDim2.new(1, 0, 0, 32)
TabBar.Position = UDim2.new(0, 0, 0, 39)
TabBar.BackgroundColor3 = C.Surface
TabBar.BorderSizePixel = 0
TabBar.Parent = Main
Pd(TabBar, 3, 3, 6, 6)

local TabBarLayout = Instance.new("UIListLayout")
TabBarLayout.FillDirection = Enum.FillDirection.Horizontal
TabBarLayout.Padding = UDim.new(0, 4)
TabBarLayout.VerticalAlignment = Enum.VerticalAlignment.Center
TabBarLayout.Parent = TabBar

local Sep2 = Instance.new("Frame")
Sep2.Size = UDim2.new(1, 0, 0, 1)
Sep2.Position = UDim2.new(0, 0, 1, 0)
Sep2.BackgroundColor3 = C.Border
Sep2.BorderSizePixel = 0
Sep2.Parent = TabBar

-- Content
local Content = Instance.new("Frame")
Content.Size = UDim2.new(1, 0, 1, -72)
Content.Position = UDim2.new(0, 0, 0, 72)
Content.BackgroundTransparency = 1
Content.Parent = Main

-- Tab system
local Pages = {}
local TabBtns = {}
local ActiveTab = nil

local function MkPage(name)
    local f = Instance.new("Frame")
    f.Name = name; f.Size = UDim2.new(1, 0, 1, 0)
    f.BackgroundTransparency = 1; f.Visible = false; f.Parent = Content
    Pages[name] = f; return f
end

local function MkTab(name, icon, order)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0, 105, 0, 24)
    b.BackgroundColor3 = C.Card; b.BackgroundTransparency = 1
    b.Text = icon .. " " .. name; b.TextSize = 10
    b.Font = Enum.Font.GothamBold; b.TextColor3 = C.GrayDark
    b.AutoButtonColor = false; b.LayoutOrder = order; b.Parent = TabBar
    Crn(b, 4)
    TabBtns[name] = b
    
    b.MouseButton1Click:Connect(function()
        for n, btn in pairs(TabBtns) do
            Tw(btn, {TextColor3 = C.GrayDark, BackgroundTransparency = 1}, 0.15)
            if Pages[n] then Pages[n].Visible = false end
        end
        Tw(b, {TextColor3 = C.White, BackgroundTransparency = 0.85}, 0.15)
        if Pages[name] then Pages[name].Visible = true end
        ActiveTab = name
    end)
    b.MouseEnter:Connect(function() if ActiveTab ~= name then Tw(b, {BackgroundTransparency = 0.92}, 0.1) end end)
    b.MouseLeave:Connect(function() if ActiveTab ~= name then Tw(b, {BackgroundTransparency = 1}, 0.1) end end)
end

MkTab("Remote Spy", "ğŸ“¡", 1)
MkTab("Deep Scan", "ğŸ”¬", 2)
MkTab("Explorer", "ğŸ“‚", 3)
MkTab("HÆ°á»›ng Dáº«n", "ğŸ“‹", 4)

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘              TAB 1: REMOTE SPY (ADVANCED)                â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local RemotePage = MkPage("Remote Spy")

-- Control bar
local RCtrl = Instance.new("Frame")
RCtrl.Size = UDim2.new(1, -12, 0, 36)
RCtrl.Position = UDim2.new(0, 6, 0, 4)
RCtrl.BackgroundColor3 = C.Card
RCtrl.Parent = RemotePage
Crn(RCtrl, 6); Pd(RCtrl, 3, 3, 6, 6)

local RCtrlLayout = Instance.new("UIListLayout")
RCtrlLayout.FillDirection = Enum.FillDirection.Horizontal
RCtrlLayout.Padding = UDim.new(0, 5)
RCtrlLayout.VerticalAlignment = Enum.VerticalAlignment.Center
RCtrlLayout.Parent = RCtrl

-- Buttons helper
local function CtrlBtn(parent, text, color, w, order)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0, w or 90, 0, 24)
    b.BackgroundColor3 = color; b.Text = text; b.TextSize = 9
    b.Font = Enum.Font.GothamBold; b.TextColor3 = C.BG
    b.AutoButtonColor = false; b.LayoutOrder = order or 0; b.Parent = parent
    Crn(b, 4)
    b.MouseEnter:Connect(function() Tw(b, {BackgroundTransparency = 0.2}, 0.1) end)
    b.MouseLeave:Connect(function() Tw(b, {BackgroundTransparency = 0}, 0.1) end)
    return b
end

local RecordBtn  = CtrlBtn(RCtrl, "â–¶ GHI", C.Green, 70, 1)
local ClearBtn   = CtrlBtn(RCtrl, "ğŸ—‘ XÃ“A", C.Red, 65, 2)
local CopyAllBtn = CtrlBtn(RCtrl, "ğŸ“‹ COPY Táº¤T Cáº¢", C.Blue, 110, 3)
local CopyStackBtn = CtrlBtn(RCtrl, "ğŸ“‹ COPY + STACK", C.Purple, 115, 4)

local CountLbl = Instance.new("TextLabel")
CountLbl.Size = UDim2.new(0, 80, 0, 24)
CountLbl.BackgroundTransparency = 1
CountLbl.Text = "ğŸ“Š 0"
CountLbl.TextSize = 10; CountLbl.Font = Enum.Font.GothamBold
CountLbl.TextColor3 = C.Gray; CountLbl.LayoutOrder = 5
CountLbl.Parent = RCtrl

local StatusDot = Instance.new("Frame")
StatusDot.Size = UDim2.new(0, 8, 0, 8)
StatusDot.BackgroundColor3 = C.Red
StatusDot.LayoutOrder = 6; StatusDot.Parent = RCtrl
Crn(StatusDot, 4)

-- Remote log scroll
local RScroll = Instance.new("ScrollingFrame")
RScroll.Size = UDim2.new(1, -12, 1, -46)
RScroll.Position = UDim2.new(0, 6, 0, 44)
RScroll.BackgroundColor3 = C.Card
RScroll.BorderSizePixel = 0
RScroll.ScrollBarThickness = 3
RScroll.ScrollBarImageColor3 = C.Gray
RScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
RScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
RScroll.Parent = RemotePage
Crn(RScroll, 6); Pd(RScroll, 4, 4, 4, 4)

local RLayout = Instance.new("UIListLayout")
RLayout.SortOrder = Enum.SortOrder.LayoutOrder
RLayout.Padding = UDim.new(0, 3)
RLayout.Parent = RScroll

-- ==================== ADD LOG ENTRY ====================
local logIdx = 0

local function AddLogEntry(data)
    logIdx = logIdx + 1
    local idx = logIdx
    
    -- Store
    table.insert(SpyState.RemoteLogs, data)
    SpyState.TotalCaught = SpyState.TotalCaught + 1
    if data.remoteType == "Event" then SpyState.EventCount = SpyState.EventCount + 1
    else SpyState.FuncCount = SpyState.FuncCount + 1 end
    
    CountLbl.Text = string.format("ğŸ“Š %d (E:%d F:%d)", SpyState.TotalCaught, SpyState.EventCount, SpyState.FuncCount)
    
    -- UI Entry
    local entry = Instance.new("Frame")
    entry.Size = UDim2.new(1, 0, 0, 0)
    entry.AutomaticSize = Enum.AutomaticSize.Y
    entry.BackgroundColor3 = C.BG
    entry.LayoutOrder = idx
    entry.Parent = RScroll
    Crn(entry, 5); Pd(entry, 6, 6, 8, 8)
    
    local eLayout = Instance.new("UIListLayout")
    eLayout.Padding = UDim.new(0, 3)
    eLayout.Parent = entry
    
    -- Line 1: Type badge + Number + Name + Copy
    local line1 = Instance.new("Frame")
    line1.Size = UDim2.new(1, 0, 0, 18)
    line1.BackgroundTransparency = 1
    line1.LayoutOrder = 1
    line1.Parent = entry
    
    local badge = Instance.new("TextLabel")
    badge.Size = UDim2.new(0, 45, 0, 16)
    badge.Position = UDim2.new(0, 0, 0, 1)
    badge.BackgroundColor3 = data.remoteType == "Event" and C.Green or C.Purple
    badge.Text = data.remoteType == "Event" and "EVENT" or "FUNC"
    badge.TextSize = 7; badge.Font = Enum.Font.GothamBlack
    badge.TextColor3 = C.BG; badge.Parent = line1
    Crn(badge, 3)
    
    local numLbl = Instance.new("TextLabel")
    numLbl.Size = UDim2.new(0, 30, 0, 18)
    numLbl.Position = UDim2.new(0, 48, 0, 0)
    numLbl.BackgroundTransparency = 1
    numLbl.Text = "#" .. idx
    numLbl.TextSize = 9; numLbl.Font = Enum.Font.GothamBold
    numLbl.TextColor3 = C.GrayDark; numLbl.TextXAlignment = Enum.TextXAlignment.Left
    numLbl.Parent = line1
    
    local nameLbl = Instance.new("TextLabel")
    nameLbl.Size = UDim2.new(1, -170, 0, 18)
    nameLbl.Position = UDim2.new(0, 78, 0, 0)
    nameLbl.BackgroundTransparency = 1
    nameLbl.Text = data.remoteName
    nameLbl.TextSize = 12; nameLbl.Font = Enum.Font.GothamBold
    nameLbl.TextColor3 = C.White; nameLbl.TextXAlignment = Enum.TextXAlignment.Left
    nameLbl.TextTruncate = Enum.TextTruncate.AtEnd
    nameLbl.Parent = line1
    
    -- Copy single
    local cpBtn = Instance.new("TextButton")
    cpBtn.Size = UDim2.new(0, 45, 0, 16)
    cpBtn.Position = UDim2.new(1, -95, 0, 1)
    cpBtn.BackgroundColor3 = C.Blue
    cpBtn.Text = "ğŸ“‹ Copy"; cpBtn.TextSize = 7
    cpBtn.Font = Enum.Font.GothamBold; cpBtn.TextColor3 = C.White
    cpBtn.AutoButtonColor = false; cpBtn.Parent = line1
    Crn(cpBtn, 3)
    
    cpBtn.MouseButton1Click:Connect(function()
        local txt = string.format(
            "â•â•â• REMOTE #%d â•â•â•\n[%s] %s\nPath: %s\nArgs: %s\nCallStack:\n%s\nUpvalues: %s\nConstants: %s\n",
            idx, data.remoteType, data.remoteName, data.remotePath,
            data.argsSerialized, table.concat(data.callStack or {}, "\n"),
            data.upvalueInfo or "N/A", data.constantInfo or "N/A"
        )
        pcall(function() setclipboard(txt) end)
        Notify("ÄÃ£ copy Remote #" .. idx)
        cpBtn.Text = "âœ…"; task.wait(1); cpBtn.Text = "ğŸ“‹ Copy"
    end)
    
    -- Copy with reproduce code
    local repBtn = Instance.new("TextButton")
    repBtn.Size = UDim2.new(0, 42, 0, 16)
    repBtn.Position = UDim2.new(1, -47, 0, 1)
    repBtn.BackgroundColor3 = C.Orange
    repBtn.Text = "âš¡ Code"; repBtn.TextSize = 7
    repBtn.Font = Enum.Font.GothamBold; repBtn.TextColor3 = C.BG
    repBtn.AutoButtonColor = false; repBtn.Parent = line1
    Crn(repBtn, 3)
    
    repBtn.MouseButton1Click:Connect(function()
        local code = string.format(
            '-- Reproduce Remote #%d: %s\nlocal remote = game:GetService("ReplicatedStorage")\nfor _,v in pairs(remote:GetDescendants()) do\n    if v.Name == "%s" and v:IsA("%s") then\n        v:%s%s\n        break\n    end\nend',
            idx, data.remoteName, data.remoteName,
            data.remoteType == "Event" and "RemoteEvent" or "RemoteFunction",
            data.remoteType == "Event" and "FireServer" or "InvokeServer",
            data.argsCompact or "()"
        )
        pcall(function() setclipboard(code) end)
        Notify("ÄÃ£ copy code #" .. idx)
        repBtn.Text = "âœ…"; task.wait(1); repBtn.Text = "âš¡ Code"
    end)
    
    -- Line 2: Path
    local pathLbl = Instance.new("TextLabel")
    pathLbl.Size = UDim2.new(1, 0, 0, 14)
    pathLbl.BackgroundTransparency = 1
    pathLbl.Text = "ğŸ“ " .. data.remotePath
    pathLbl.TextSize = 9; pathLbl.Font = Enum.Font.GothamMedium
    pathLbl.TextColor3 = C.Cyan; pathLbl.TextXAlignment = Enum.TextXAlignment.Left
    pathLbl.TextTruncate = Enum.TextTruncate.AtEnd
    pathLbl.LayoutOrder = 2; pathLbl.Parent = entry
    
    -- Line 3: Calling Script
    if data.callingScript then
        local csLbl = Instance.new("TextLabel")
        csLbl.Size = UDim2.new(1, 0, 0, 12)
        csLbl.BackgroundTransparency = 1
        csLbl.Text = "ğŸ“œ CallingScript: " .. data.callingScript
        csLbl.TextSize = 8; csLbl.Font = Enum.Font.GothamMedium
        csLbl.TextColor3 = C.Orange; csLbl.TextXAlignment = Enum.TextXAlignment.Left
        csLbl.LayoutOrder = 3; csLbl.Parent = entry
    end
    
    -- Line 4: Args (collapsible)
    local argsFrame = Instance.new("Frame")
    argsFrame.Size = UDim2.new(1, 0, 0, 0)
    argsFrame.AutomaticSize = Enum.AutomaticSize.Y
    argsFrame.BackgroundColor3 = Color3.fromRGB(12, 12, 14)
    argsFrame.LayoutOrder = 4
    argsFrame.ClipsDescendants = true
    argsFrame.Parent = entry
    Crn(argsFrame, 4); Pd(argsFrame, 4, 4, 6, 6)
    
    local argsLbl = Instance.new("TextLabel")
    argsLbl.Size = UDim2.new(1, 0, 0, 0)
    argsLbl.AutomaticSize = Enum.AutomaticSize.Y
    argsLbl.BackgroundTransparency = 1
    argsLbl.Text = "ğŸ“¦ Args: " .. (data.argsSerialized or "()")
    argsLbl.TextSize = 9; argsLbl.Font = Enum.Font.Code
    argsLbl.TextColor3 = C.Yellow; argsLbl.TextXAlignment = Enum.TextXAlignment.Left
    argsLbl.TextWrapped = true
    argsLbl.Parent = argsFrame
    
    -- Line 5: CallStack (collapsed by default)
    if data.callStack and #data.callStack > 0 then
        local stackFrame = Instance.new("Frame")
        stackFrame.Size = UDim2.new(1, 0, 0, 18)
        stackFrame.BackgroundColor3 = Color3.fromRGB(14, 12, 18)
        stackFrame.ClipsDescendants = true
        stackFrame.LayoutOrder = 5
        stackFrame.Parent = entry
        Crn(stackFrame, 4)
        
        local stackBtn = Instance.new("TextButton")
        stackBtn.Size = UDim2.new(1, 0, 0, 18)
        stackBtn.BackgroundTransparency = 1
        stackBtn.Text = "  ğŸ” CallStack â–¼ (" .. #data.callStack .. " frames)"
        stackBtn.TextSize = 8; stackBtn.Font = Enum.Font.GothamBold
        stackBtn.TextColor3 = C.Purple; stackBtn.TextXAlignment = Enum.TextXAlignment.Left
        stackBtn.Parent = stackFrame
        
        local stackLbl = Instance.new("TextLabel")
        stackLbl.Size = UDim2.new(1, -8, 0, 0)
        stackLbl.Position = UDim2.new(0, 4, 0, 18)
        stackLbl.AutomaticSize = Enum.AutomaticSize.Y
        stackLbl.BackgroundTransparency = 1
        stackLbl.Text = table.concat(data.callStack, "\n")
        stackLbl.TextSize = 8; stackLbl.Font = Enum.Font.Code
        stackLbl.TextColor3 = C.WhiteDim; stackLbl.TextXAlignment = Enum.TextXAlignment.Left
        stackLbl.TextWrapped = true
        stackLbl.Parent = stackFrame
        
        local stackExpanded = false
        stackBtn.MouseButton1Click:Connect(function()
            stackExpanded = not stackExpanded
            local targetH = stackExpanded and (18 + stackLbl.AbsoluteSize.Y + 8) or 18
            Tw(stackFrame, {Size = UDim2.new(1, 0, 0, math.min(targetH, 150))}, 0.2)
            stackBtn.Text = stackExpanded 
                and ("  ğŸ” CallStack â–² (" .. #data.callStack .. " frames)")
                or ("  ğŸ” CallStack â–¼ (" .. #data.callStack .. " frames)")
        end)
    end
    
    -- Flash animation
    entry.BackgroundTransparency = 0.5
    Tw(entry, {BackgroundTransparency = 0}, 0.3)
    
    -- Auto scroll
    task.defer(function()
        RScroll.CanvasPosition = Vector2.new(0, RScroll.AbsoluteCanvasSize.Y)
    end)
end

-- ==================== HOOKING ENGINE ====================
local function StartHooking()
    SpyState.IsRecording = true
    RecordBtn.Text = "â¹ Dá»ªNG"
    RecordBtn.BackgroundColor3 = C.Red
    StatusDot.BackgroundColor3 = C.Green
    Notify("ğŸ”´ Äang ghi! HÃ£y thao tÃ¡c trong game...")
    
    -- Blink
    task.spawn(function()
        while SpyState.IsRecording do
            Tw(StatusDot, {BackgroundTransparency = 0.7}, 0.4)
            task.wait(0.4)
            if not SpyState.IsRecording then break end
            Tw(StatusDot, {BackgroundTransparency = 0}, 0.4)
            task.wait(0.4)
        end
    end)
    
    -- â•â•â•â•â•â•â• METHOD 1: hookmetamethod __namecall â•â•â•â•â•â•â•
    if SpyState.HasHookMeta and not SpyState.OldNamecall then
        SpyState.OldNamecall = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
            local method = getnamecallmethod()
            local args = {...}
            
            if SpyState.IsRecording and not checkcaller() then
                local isRemote = false
                local remoteType = ""
                
                if method == "FireServer" and typeof(self) == "Instance" and self:IsA("RemoteEvent") then
                    isRemote = true
                    remoteType = "Event"
                elseif method == "InvokeServer" and typeof(self) == "Instance" and self:IsA("RemoteFunction") then
                    isRemote = true
                    remoteType = "Function"
                end
                
                if isRemote then
                    -- Get calling script
                    local callerScript = nil
                    pcall(function() callerScript = getcallingscript() end)
                    
                    -- Get callstack
                    local stack = GetCallStack()
                    
                    -- Serialize args
                    local serialized = Serializer.SerializeArgs(args)
                    local compact = Serializer.SerializeCompact(args)
                    
                    -- Get upvalues/constants of calling function
                    local upInfo = ""
                    local constInfo = ""
                    pcall(function()
                        -- Try to get info about the calling function from stack level 2
                        if debug and debug.getinfo then
                            local info = debug.getinfo(2)
                            if info and info.func then
                                local fnData = ExtractFunctionData(info.func)
                                
                                local upParts = {}
                                for k, v in pairs(fnData.upvalues) do
                                    table.insert(upParts, string.format("[%s]=%s(%s)%s", 
                                        tostring(k), v.type, v.value, v.tag and " " .. v.tag or ""))
                                end
                                upInfo = table.concat(upParts, ", ")
                                
                                local constParts = {}
                                for k, v in pairs(fnData.constants) do
                                    table.insert(constParts, string.format("[%s]=%s", tostring(k), v.value))
                                end
                                constInfo = table.concat(constParts, ", ")
                            end
                        end
                    end)
                    
                    task.spawn(function()
                        AddLogEntry({
                            remoteName = self.Name,
                            remotePath = self:GetFullName(),
                            remoteType = remoteType,
                            method = method,
                            argsSerialized = serialized,
                            argsCompact = compact,
                            callStack = stack,
                            callingScript = callerScript and callerScript:GetFullName() or nil,
                            upvalueInfo = upInfo ~= "" and upInfo or nil,
                            constantInfo = constInfo ~= "" and constInfo or nil,
                            timestamp = os.clock(),
                            rawArgs = args,
                        })
                    end)
                end
            end
            
            return SpyState.OldNamecall(self, ...)
        end))
        
        print("[DX Deep Spy] âœ… __namecall hook active")
    end
    
    -- â•â•â•â•â•â•â• METHOD 2: hookmetamethod __index â•â•â•â•â•â•â•
    if SpyState.HasHookMeta and not SpyState.OldIndex then
        pcall(function()
            SpyState.OldIndex = hookmetamethod(game, "__index", newcclosure(function(self, key)
                if SpyState.IsRecording and not checkcaller() then
                    if typeof(self) == "Instance" and (key == "FireServer" or key == "InvokeServer") then
                        -- Log access to FireServer/InvokeServer
                        -- This catches cases where they store the function
                    end
                end
                return SpyState.OldIndex(self, key)
            end))
            print("[DX Deep Spy] âœ… __index hook active")
        end)
    end
    
    -- â•â•â•â•â•â•â• METHOD 3: Fallback for executors without hookmetamethod â•â•â•â•â•â•â•
    if not SpyState.HasHookMeta then
        warn("[DX Deep Spy] âš  hookmetamethod khÃ´ng cÃ³, dÃ¹ng phÆ°Æ¡ng phÃ¡p thay tháº¿...")
        
        local function HookRemoteInstance(remote)
            if remote:IsA("RemoteEvent") then
                local original = remote.FireServer
                remote.FireServer = newcclosure(function(self, ...)
                    if SpyState.IsRecording then
                        local args = {...}
                        task.spawn(function()
                            AddLogEntry({
                                remoteName = remote.Name,
                                remotePath = remote:GetFullName(),
                                remoteType = "Event",
                                method = "FireServer",
                                argsSerialized = Serializer.SerializeArgs(args),
                                argsCompact = Serializer.SerializeCompact(args),
                                callStack = GetCallStack(),
                                timestamp = os.clock(),
                                rawArgs = args,
                            })
                        end)
                    end
                    return original(self, ...)
                end)
            elseif remote:IsA("RemoteFunction") then
                local original = remote.InvokeServer
                remote.InvokeServer = newcclosure(function(self, ...)
                    if SpyState.IsRecording then
                        local args = {...}
                        task.spawn(function()
                            AddLogEntry({
                                remoteName = remote.Name,
                                remotePath = remote:GetFullName(),
                                remoteType = "Function",
                                method = "InvokeServer",
                                argsSerialized = Serializer.SerializeArgs(args),
                                argsCompact = Serializer.SerializeCompact(args),
                                callStack = GetCallStack(),
                                timestamp = os.clock(),
                                rawArgs = args,
                            })
                        end)
                    end
                    return original(self, ...)
                end)
            end
        end
        
        -- Hook all existing
        for _, svc in ipairs({ReplicatedStorage, game:GetService("Workspace"), game:GetService("Players")}) do
            for _, obj in pairs(svc:GetDescendants()) do
                if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
                    pcall(function() HookRemoteInstance(obj) end)
                end
            end
        end
        
        -- Hook new ones
        local conn = ReplicatedStorage.DescendantAdded:Connect(function(obj)
            task.wait(0.1)
            if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
                pcall(function() HookRemoteInstance(obj) end)
            end
        end)
        table.insert(SpyState.Hooks, conn)
    end
end

local function StopHooking()
    SpyState.IsRecording = false
    RecordBtn.Text = "â–¶ GHI"
    RecordBtn.BackgroundColor3 = C.Green
    StatusDot.BackgroundColor3 = C.Red
    Tw(StatusDot, {BackgroundTransparency = 0}, 0.2)
    Notify("â¹ Dá»«ng! Tá»•ng: " .. SpyState.TotalCaught)
end

RecordBtn.MouseButton1Click:Connect(function()
    if SpyState.IsRecording then StopHooking() else StartHooking() end
end)

ClearBtn.MouseButton1Click:Connect(function()
    for _, c in pairs(RScroll:GetChildren()) do if c:IsA("Frame") then c:Destroy() end end
    SpyState.RemoteLogs = {}
    SpyState.TotalCaught = 0; SpyState.EventCount = 0; SpyState.FuncCount = 0
    logIdx = 0
    CountLbl.Text = "ğŸ“Š 0"
    Notify("ğŸ—‘ ÄÃ£ xÃ³a!")
end)

CopyAllBtn.MouseButton1Click:Connect(function()
    if #SpyState.RemoteLogs == 0 then Notify("âš  ChÆ°a cÃ³ dá»¯ liá»‡u!") return end
    
    local txt = "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"
    txt = txt .. "  DUNGEONX DEEP SPY - REMOTE LOG\n"
    txt = txt .. "  Game ID: " .. game.PlaceId .. "\n"
    txt = txt .. "  Total: " .. #SpyState.RemoteLogs .. " remotes\n"
    txt = txt .. "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"
    
    for i, entry in ipairs(SpyState.RemoteLogs) do
        txt = txt .. string.format("â”â”â” #%d [%s] %s â”â”â”\n", i, entry.remoteType, entry.remoteName)
        txt = txt .. "Path: " .. entry.remotePath .. "\n"
        if entry.callingScript then txt = txt .. "CallingScript: " .. entry.callingScript .. "\n" end
        txt = txt .. "Args: " .. entry.argsSerialized .. "\n"
        if entry.callStack then txt = txt .. "CallStack:\n" .. table.concat(entry.callStack, "\n") .. "\n" end
        if entry.upvalueInfo then txt = txt .. "Upvalues: " .. entry.upvalueInfo .. "\n" end
        if entry.constantInfo then txt = txt .. "Constants: " .. entry.constantInfo .. "\n" end
        txt = txt .. "\n"
    end
    
    pcall(function() setclipboard(txt) end)
    Notify("âœ… ÄÃ£ copy " .. #SpyState.RemoteLogs .. " remotes!")
    CopyAllBtn.Text = "âœ… Done!"; task.wait(2); CopyAllBtn.Text = "ğŸ“‹ COPY Táº¤T Cáº¢"
end)

CopyStackBtn.MouseButton1Click:Connect(function()
    if #SpyState.RemoteLogs == 0 then Notify("âš  ChÆ°a cÃ³ dá»¯ liá»‡u!") return end
    
    local txt = "â•â•â•â•â•â•â•â•â•â• FULL DUMP WITH CALLSTACKS â•â•â•â•â•â•â•â•â•â•\n\n"
    for i, entry in ipairs(SpyState.RemoteLogs) do
        txt = txt .. string.format("â•â•â• #%d [%s] %s â•â•â•\n", i, entry.remoteType, entry.remoteName)
        txt = txt .. "Path: " .. entry.remotePath .. "\n"
        if entry.callingScript then txt = txt .. "Script: " .. entry.callingScript .. "\n" end
        txt = txt .. "Args:\n" .. entry.argsSerialized .. "\n"
        if entry.callStack then
            txt = txt .. "CallStack:\n" .. table.concat(entry.callStack, "\n") .. "\n"
        end
        if entry.upvalueInfo then txt = txt .. "Upvalues: " .. entry.upvalueInfo .. "\n" end
        if entry.constantInfo then txt = txt .. "Constants: " .. entry.constantInfo .. "\n" end
        txt = txt .. "\n"
    end
    
    pcall(function() setclipboard(txt) end)
    Notify("âœ… ÄÃ£ copy full dump!")
    CopyStackBtn.Text = "âœ… Done!"; task.wait(2); CopyStackBtn.Text = "ğŸ“‹ COPY + STACK"
end)

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘              TAB 2: DEEP SCAN                            â•‘
-- â•‘  GC Scanning + Nil Instances + Hidden Remotes           â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local DeepPage = MkPage("Deep Scan")

local DCtrl = Instance.new("Frame")
DCtrl.Size = UDim2.new(1, -12, 0, 36)
DCtrl.Position = UDim2.new(0, 6, 0, 4)
DCtrl.BackgroundColor3 = C.Card
DCtrl.Parent = DeepPage
Crn(DCtrl, 6); Pd(DCtrl, 3, 3, 6, 6)

local DCtrlLayout = Instance.new("UIListLayout")
DCtrlLayout.FillDirection = Enum.FillDirection.Horizontal
DCtrlLayout.Padding = UDim.new(0, 5)
DCtrlLayout.VerticalAlignment = Enum.VerticalAlignment.Center
DCtrlLayout.Parent = DCtrl

local GCScanBtn    = CtrlBtn(DCtrl, "ğŸ”¬ GC SCAN", C.Purple, 90, 1)
local NilScanBtn   = CtrlBtn(DCtrl, "ğŸ‘» NIL SCAN", C.Orange, 90, 2)
local ModScanBtn   = CtrlBtn(DCtrl, "ğŸ“œ MODULE SCAN", C.Cyan, 100, 3)
local CopyDeepBtn  = CtrlBtn(DCtrl, "ğŸ“‹ COPY Táº¤T Cáº¢", C.Blue, 105, 4)

local DScanStatus = Instance.new("TextLabel")
DScanStatus.Size = UDim2.new(0, 120, 0, 24)
DScanStatus.BackgroundTransparency = 1
DScanStatus.Text = "â³ ChÆ°a scan"
DScanStatus.TextSize = 9; DScanStatus.Font = Enum.Font.GothamBold
DScanStatus.TextColor3 = C.Gray; DScanStatus.LayoutOrder = 5
DScanStatus.Parent = DCtrl

local DScroll = Instance.new("ScrollingFrame")
DScroll.Size = UDim2.new(1, -12, 1, -46)
DScroll.Position = UDim2.new(0, 6, 0, 44)
DScroll.BackgroundColor3 = C.Card
DScroll.BorderSizePixel = 0
DScroll.ScrollBarThickness = 3
DScroll.ScrollBarImageColor3 = C.Gray
DScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
DScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
DScroll.Parent = DeepPage
Crn(DScroll, 6); Pd(DScroll, 4, 4, 4, 4)

local DLayout = Instance.new("UIListLayout")
DLayout.Padding = UDim.new(0, 3)
DLayout.Parent = DScroll

local deepOrder = 0

local function AddDeepEntry(title, content, color)
    deepOrder = deepOrder + 1
    
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1, 0, 0, 0)
    f.AutomaticSize = Enum.AutomaticSize.Y
    f.BackgroundColor3 = C.BG
    f.LayoutOrder = deepOrder
    f.Parent = DScroll
    Crn(f, 4); Pd(f, 5, 5, 8, 8)
    
    local fl = Instance.new("UIListLayout")
    fl.Padding = UDim.new(0, 2)
    fl.Parent = f
    
    local tl = Instance.new("TextLabel")
    tl.Size = UDim2.new(1, 0, 0, 16)
    tl.BackgroundTransparency = 1
    tl.Text = title; tl.TextSize = 10
    tl.Font = Enum.Font.GothamBold
    tl.TextColor3 = color or C.White
    tl.TextXAlignment = Enum.TextXAlignment.Left
    tl.LayoutOrder = 1
    tl.Parent = f
    
    local cl = Instance.new("TextLabel")
    cl.Size = UDim2.new(1, 0, 0, 0)
    cl.AutomaticSize = Enum.AutomaticSize.Y
    cl.BackgroundColor3 = Color3.fromRGB(12, 12, 14)
    cl.Text = "  " .. content; cl.TextSize = 9
    cl.Font = Enum.Font.Code
    cl.TextColor3 = C.WhiteDim
    cl.TextXAlignment = Enum.TextXAlignment.Left
    cl.TextWrapped = true
    cl.LayoutOrder = 2
    cl.Parent = f
    Crn(cl, 3); Pd(cl, 3, 3, 4, 4)
    
    -- Store for copy
    table.insert(SpyState.DeepScanData, {title = title, content = content})
end

-- GC Scan button
GCScanBtn.MouseButton1Click:Connect(function()
    GCScanBtn.Text = "â³ Scanning..."
    DScanStatus.Text = "ğŸ”„ GC Scanning..."
    task.wait(0.1)
    
    local results = GCScanner.ScanForRemotes()
    
    AddDeepEntry(
        "ğŸ“Š GC SCAN SUMMARY",
        string.format("Scanned: %d objects\nFunctions with Remotes: %d\nTables with Remotes: %d\nKeyword matches: %d",
            results.total_scanned,
            #results.functions_with_remotes,
            #results.tables_with_remotes,
            #results.remote_keywords
        ),
        C.Cyan
    )
    
    for _, item in ipairs(results.functions_with_remotes) do
        AddDeepEntry(
            "â­ HIDDEN REMOTE IN FUNCTION",
            string.format("Remote: %s [%s]\nPath: %s\nUpvalue Index: %d\nFunction Source: %s",
                item.remoteName, item.remoteClass, item.remotePath,
                item.upvalueIndex, 
                item.functionInfo and item.functionInfo.source or "unknown"
            ),
            C.Green
        )
    end
    
    for _, item in ipairs(results.tables_with_remotes) do
        AddDeepEntry(
            "ğŸ“¦ REMOTE IN TABLE",
            string.format("Key: %s\nRemote: %s [%s]\nPath: %s",
                item.key, item.remoteName, item.remoteClass, item.remotePath
            ),
            C.Yellow
        )
    end
    
    for _, item in ipairs(results.remote_keywords) do
        AddDeepEntry(
            "ğŸ”‘ KEYWORD: " .. item.keyword,
            string.format("Constant: \"%s\" [idx:%d]\nSource: %s",
                item.constant, item.constantIndex,
                item.functionInfo and item.functionInfo.source or "unknown"
            ),
            C.Orange
        )
    end
    
    GCScanBtn.Text = "ğŸ”¬ GC SCAN"
    DScanStatus.Text = "âœ… GC: " .. results.total_scanned .. " objects"
    Notify("âœ… GC Scan xong!")
end)

-- Nil Scan button
NilScanBtn.MouseButton1Click:Connect(function()
    NilScanBtn.Text = "â³ Scanning..."
    task.wait(0.1)
    
    local results = GCScanner.ScanNilInstances()
    
    if #results == 0 then
        AddDeepEntry("ğŸ‘» NIL INSTANCES", "KhÃ´ng tÃ¬m tháº¥y Remote áº©n trong nil", C.Gray)
    else
        for _, item in ipairs(results) do
            SpyState.HiddenCount = SpyState.HiddenCount + 1
            AddDeepEntry(
                "ğŸ‘» NIL REMOTE: " .. item.name,
                string.format("Class: %s\nFull: %s\nParent: %s",
                    item.className, item.fullName, item.parent
                ),
                C.Red
            )
        end
    end
    
    NilScanBtn.Text = "ğŸ‘» NIL SCAN"
    DScanStatus.Text = "ğŸ‘» Nil: " .. #results .. " found"
    Notify("âœ… Nil Scan: " .. #results .. " found")
end)

-- Module Scan button
ModScanBtn.MouseButton1Click:Connect(function()
    ModScanBtn.Text = "â³ Scanning..."
    task.wait(0.1)
    
    local results = GCScanner.ScanHiddenModules()
    
    if #results == 0 then
        AddDeepEntry("ğŸ“œ LOADED MODULES", "KhÃ´ng tÃ¬m tháº¥y module liÃªn quan", C.Gray)
    else
        for _, item in ipairs(results) do
            AddDeepEntry(
                "ğŸ“œ MODULE: " .. item.name,
                string.format("Path: %s\nKeyword: %s", item.path, item.keyword),
                C.Purple
            )
        end
    end
    
    ModScanBtn.Text = "ğŸ“œ MODULE SCAN"
    Notify("âœ… Module Scan: " .. #results .. " found")
end)

-- Copy Deep Scan
CopyDeepBtn.MouseButton1Click:Connect(function()
    if #SpyState.DeepScanData == 0 then Notify("âš  ChÆ°a scan!") return end
    
    local txt = "â•â•â•â•â•â•â•â•â•â• DEEP SCAN RESULTS â•â•â•â•â•â•â•â•â•â•\n"
    txt = txt .. "Game ID: " .. game.PlaceId .. "\n\n"
    
    for i, item in ipairs(SpyState.DeepScanData) do
        txt = txt .. "â”â”â” " .. item.title .. " â”â”â”\n"
        txt = txt .. item.content .. "\n\n"
    end
    
    pcall(function() setclipboard(txt) end)
    Notify("âœ… ÄÃ£ copy Deep Scan!")
    CopyDeepBtn.Text = "âœ… Done!"; task.wait(2); CopyDeepBtn.Text = "ğŸ“‹ COPY Táº¤T Cáº¢"
end)

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘              TAB 3: EXPLORER                             â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local ExpPage = MkPage("Explorer")

local ECtrl = Instance.new("Frame")
ECtrl.Size = UDim2.new(1, -12, 0, 36)
ECtrl.Position = UDim2.new(0, 6, 0, 4)
ECtrl.BackgroundColor3 = C.Card
ECtrl.Parent = ExpPage
Crn(ECtrl, 6); Pd(ECtrl, 3, 3, 6, 6)

local ECtrlLayout = Instance.new("UIListLayout")
ECtrlLayout.FillDirection = Enum.FillDirection.Horizontal
ECtrlLayout.Padding = UDim.new(0, 5)
ECtrlLayout.VerticalAlignment = Enum.VerticalAlignment.Center
ECtrlLayout.Parent = ECtrl

local ScanWSBtn = CtrlBtn(ECtrl, "ğŸ“‚ Workspace", C.Orange, 100, 1)
local ScanRSBtn = CtrlBtn(ECtrl, "ğŸ“‚ Replicated", C.Purple, 100, 2)
local ScanPGBtn = CtrlBtn(ECtrl, "ğŸ“‚ PlayerGui", C.Cyan, 95, 3)
local CopyEBtn  = CtrlBtn(ECtrl, "ğŸ“‹ COPY", C.Blue, 70, 4)

local EScroll = Instance.new("ScrollingFrame")
EScroll.Size = UDim2.new(1, -12, 1, -46)
EScroll.Position = UDim2.new(0, 6, 0, 44)
EScroll.BackgroundColor3 = C.Card
EScroll.BorderSizePixel = 0
EScroll.ScrollBarThickness = 3
EScroll.ScrollBarImageColor3 = C.Gray
EScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
EScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
EScroll.Parent = ExpPage
Crn(EScroll, 6); Pd(EScroll, 4, 4, 4, 4)

local ELayout = Instance.new("UIListLayout")
ELayout.Padding = UDim.new(0, 1)
ELayout.Parent = EScroll

local explorerText = ""

local function GetIcon(cn)
    local t = {
        Folder="ğŸ“",RemoteEvent="ğŸ“¡",RemoteFunction="ğŸ“",ModuleScript="ğŸ“œ",
        LocalScript="ğŸ’»",Script="âš™",Part="ğŸŸ¦",Model="ğŸ“¦",Tool="ğŸ”§",
        StringValue="ğŸ“",IntValue="ğŸ”¢",BoolValue="âœ…",Humanoid="ğŸ‘¤",
        ProximityPrompt="ğŸ’¬",ScreenGui="ğŸ–¥",Frame="ğŸ”²",TextButton="ğŸ”˜",
        Sound="ğŸ”Š",Animation="ğŸ¬",Accessory="ğŸ‘‘",MeshPart="ğŸ”·",
        BindableEvent="ğŸ””",BindableFunction="ğŸ“²",ObjectValue="ğŸ”—",
    }
    return t[cn] or "â–ª"
end

local function ScanAndDisplay(root, title, maxDepth)
    maxDepth = maxDepth or 4
    
    for _, c in pairs(EScroll:GetChildren()) do if c:IsA("TextLabel") then c:Destroy() end end
    explorerText = ""
    
    local order = 0
    local fullText = "â•â•â• " .. title .. " â•â•â•\n"
    
    local function Scan(obj, depth)
        if depth > maxDepth then return end
        order = order + 1
        
        local icon = GetIcon(obj.ClassName)
        local indent = string.rep("  ", depth)
        local extra = ""
        
        pcall(function()
            if obj:IsA("StringValue") then extra = ' = "' .. tostring(obj.Value):sub(1, 40) .. '"'
            elseif obj:IsA("IntValue") or obj:IsA("NumberValue") then extra = " = " .. tostring(obj.Value)
            elseif obj:IsA("BoolValue") then extra = " = " .. tostring(obj.Value)
            elseif obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then extra = " â­"
            elseif obj:IsA("Humanoid") then extra = string.format(" (HP:%.0f/%.0f)", obj.Health, obj.MaxHealth)
            end
        end)
        
        local line = string.format("%s%s %s [%s]%s", indent, icon, obj.Name, obj.ClassName, extra)
        fullText = fullText .. line .. "\n"
        
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1, 0, 0, 16)
        lbl.BackgroundTransparency = order % 2 == 0 and 0.97 or 1
        lbl.BackgroundColor3 = C.Surface
        lbl.Text = line; lbl.TextSize = 9
        lbl.Font = Enum.Font.Code
        lbl.TextXAlignment = Enum.TextXAlignment.Left
        lbl.TextTruncate = Enum.TextTruncate.AtEnd
        lbl.LayoutOrder = order
        lbl.Parent = EScroll
        
        if obj.ClassName == "RemoteEvent" or obj.ClassName == "RemoteFunction" then
            lbl.TextColor3 = C.Green
        elseif obj.ClassName:find("Script") then
            lbl.TextColor3 = C.Yellow
        elseif obj.ClassName == "Folder" then
            lbl.TextColor3 = C.Cyan
        else
            lbl.TextColor3 = C.Gray
        end
        
        local ok, children = pcall(function() return obj:GetChildren() end)
        if ok and children then
            if #children > 0 and depth < maxDepth then
                for _, child in ipairs(children) do Scan(child, depth + 1) end
            elseif #children > 0 then
                order = order + 1
                local more = indent .. "  ... (" .. #children .. " more)"
                fullText = fullText .. more .. "\n"
                local ml = Instance.new("TextLabel")
                ml.Size = UDim2.new(1, 0, 0, 14)
                ml.BackgroundTransparency = 1
                ml.Text = more; ml.TextSize = 8; ml.Font = Enum.Font.Code
                ml.TextColor3 = C.GrayDark; ml.TextXAlignment = Enum.TextXAlignment.Left
                ml.LayoutOrder = order; ml.Parent = EScroll
            end
        end
    end
    
    Scan(root, 0)
    explorerText = fullText
    Notify("âœ… Scan: " .. order .. " objects")
end

ScanWSBtn.MouseButton1Click:Connect(function()
    ScanWSBtn.Text = "â³..."; task.wait(0.1)
    ScanAndDisplay(Workspace, "Workspace", 4)
    ScanWSBtn.Text = "ğŸ“‚ Workspace"
end)

ScanRSBtn.MouseButton1Click:Connect(function()
    ScanRSBtn.Text = "â³..."; task.wait(0.1)
    ScanAndDisplay(ReplicatedStorage, "ReplicatedStorage", 5)
    ScanRSBtn.Text = "ğŸ“‚ Replicated"
end)

ScanPGBtn.MouseButton1Click:Connect(function()
    ScanPGBtn.Text = "â³..."; task.wait(0.1)
    ScanAndDisplay(LocalPlayer.PlayerGui, "PlayerGui", 4)
    ScanPGBtn.Text = "ğŸ“‚ PlayerGui"
end)

CopyEBtn.MouseButton1Click:Connect(function()
    if explorerText == "" then Notify("âš  Scan trÆ°á»›c!") return end
    local header = "â•â•â•â•â•â•â•â•â•â• EXPLORER DUMP â•â•â•â•â•â•â•â•â•â•\nGame: " .. game.PlaceId .. "\n\n"
    pcall(function() setclipboard(header .. explorerText) end)
    Notify("âœ… ÄÃ£ copy Explorer!")
    CopyEBtn.Text = "âœ…"; task.wait(2); CopyEBtn.Text = "ğŸ“‹ COPY"
end)

-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘              TAB 4: HÆ¯á»šNG DáºªN                            â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local GuidePage = MkPage("HÆ°á»›ng Dáº«n")

local GScroll = Instance.new("ScrollingFrame")
GScroll.Size = UDim2.new(1, -12, 1, -8)
GScroll.Position = UDim2.new(0, 6, 0, 4)
GScroll.BackgroundColor3 = C.Card
GScroll.BorderSizePixel = 0
GScroll.ScrollBarThickness = 3
GScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
GScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
GScroll.Parent = GuidePage
Crn(GScroll, 6); Pd(GScroll, 8, 8, 8, 8)

local GLayout = Instance.new("UIListLayout")
GLayout.Padding = UDim.new(0, 6)
GLayout.Parent = GScroll

local guides = {
    {
        title = "ğŸŸ¢ BÆ¯á»šC 1: DEEP SCAN (LÃ m Ä‘áº§u tiÃªn)",
        color = C.Green,
        steps = {
            "1. VÃ o tab 'Deep Scan'",
            "2. Nháº¥n 'ğŸ”¬ GC SCAN' â†’ Äá»£i káº¿t quáº£",
            "3. Nháº¥n 'ğŸ‘» NIL SCAN' â†’ Äá»£i káº¿t quáº£",
            "4. Nháº¥n 'ğŸ“œ MODULE SCAN' â†’ Äá»£i káº¿t quáº£",
            "5. Nháº¥n 'ğŸ“‹ COPY Táº¤T Cáº¢'",
            "6. Gá»¬I CHO TÃ”I á»Ÿ Ä‘Ã¢y",
        }
    },
    {
        title = "ğŸŸ¡ BÆ¯á»šC 2: GHI REMOTE - VÃ€O RAID",
        color = C.Yellow,
        steps = {
            "1. VÃ o tab 'Remote Spy'",
            "2. Nháº¥n 'â–¶ GHI'",
            "3. Äi Ä‘áº¿n NPC Raid â†’ Má»Ÿ menu â†’ Chá»n mode",
            "4. VÃ o raid â†’ Äá»£i vÃ o map",
            "5. Nháº¥n 'â¹ Dá»ªNG'",
            "6. Nháº¥n 'ğŸ“‹ COPY + STACK'",
            "7. Gá»¬I CHO TÃ”I",
        }
    },
    {
        title = "ğŸ”µ BÆ¯á»šC 3: GHI REMOTE - DÃ™NG SKILL",
        color = C.Blue,
        steps = {
            "1. XÃ“A logs cÅ© â†’ Nháº¥n 'â–¶ GHI' láº¡i",
            "2. Equip Ope fruit (slot 1) â†’ Nháº¥n Z",
            "3. Equip Kioru V2 (slot 2) â†’ Nháº¥n Z, X",
            "4. Click chuá»™t vÃ i láº§n",
            "5. Equip melee (slot 3) â†’ Nháº¥n Z,X,C,V,E,B",
            "6. 'â¹ Dá»ªNG' â†’ 'ğŸ“‹ COPY + STACK' â†’ Gá»¬I",
        }
    },
    {
        title = "ğŸŸ£ BÆ¯á»šC 4: SCAN EXPLORER",
        color = C.Purple,
        steps = {
            "1. VÃ o tab 'Explorer'",
            "2. Nháº¥n 'Workspace' â†’ ğŸ“‹ COPY â†’ Gá»¬I",
            "3. Nháº¥n 'Replicated' â†’ ğŸ“‹ COPY â†’ Gá»¬I",
            "4. Nháº¥n 'PlayerGui' â†’ ğŸ“‹ COPY â†’ Gá»¬I",
        }
    },
    {
        title = "ğŸŸ  BÆ¯á»šC 5: GHI THÃŠM (Náº¾U Cáº¦N)",
        color = C.Orange,
        steps = {
            "â€¢ Equip/Unequip item â†’ GHI remote",
            "â€¢ Nháº­n damage â†’ GHI remote",
            "â€¢ Thu tháº­p reward â†’ GHI remote",
            "â€¢ Di chuyá»ƒn/Teleport â†’ GHI remote",
            "Má»—i láº§n: XÃ“A â†’ GHI â†’ Dá»ªNG â†’ COPY â†’ Gá»¬I",
        }
    },
    {
        title = "âš  QUAN TRá»ŒNG",
        color = C.Red,
        steps = {
            "â€¢ Gá»­i Táº¤T Cáº¢ data cho tÃ´i á»Ÿ Ä‘Ã¢y",
            "â€¢ CÃ ng nhiá»u data â†’ Script cÃ ng chÃ­nh xÃ¡c",
            "â€¢ NÃºt 'âš¡ Code' = copy code tÃ¡i táº¡o remote Ä‘Ã³",
            "â€¢ Má»—i remote cÃ³ CallStack = biáº¿t code nÃ o gá»i nÃ³",
            "â€¢ Right Ctrl = áº¨n/Hiá»‡n tool",
        }
    },
}

for i, g in ipairs(guides) do
    local sf = Instance.new("Frame")
    sf.Size = UDim2.new(1, 0, 0, 0)
    sf.AutomaticSize = Enum.AutomaticSize.Y
    sf.BackgroundColor3 = C.BG
    sf.LayoutOrder = i; sf.Parent = GScroll
    Crn(sf, 6); Pd(sf, 8, 8, 10, 10)
    
    local sl = Instance.new("UIListLayout")
    sl.Padding = UDim.new(0, 3); sl.Parent = sf
    
    local tl = Instance.new("TextLabel")
    tl.Size = UDim2.new(1, 0, 0, 18)
    tl.BackgroundTransparency = 1
    tl.Text = g.title; tl.TextSize = 11
    tl.Font = Enum.Font.GothamBold
    tl.TextColor3 = g.color
    tl.TextXAlignment = Enum.TextXAlignment.Left
    tl.LayoutOrder = 0; tl.Parent = sf
    
    for j, step in ipairs(g.steps) do
        local stl = Instance.new("TextLabel")
        stl.Size = UDim2.new(1, 0, 0, 14)
        stl.BackgroundTransparency = 1
        stl.Text = "  " .. step; stl.TextSize = 9
        stl.Font = Enum.Font.GothamMedium
        stl.TextColor3 = C.Gray
        stl.TextXAlignment = Enum.TextXAlignment.Left
        stl.LayoutOrder = j; stl.Parent = sf
    end
end

-- ==================== DEFAULT TAB ====================
task.delay(0.6, function()
    if TabBtns["HÆ°á»›ng Dáº«n"] then
        TabBtns["HÆ°á»›ng Dáº«n"].MouseButton1Click:Fire()
    end
end)

-- ==================== KEYBIND ====================
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.RightControl then
        Main.Visible = not Main.Visible
    end
end)

-- ==================== COMPLETE ====================
Notify("âœ… Deep Spy Tool sáºµn sÃ ng! Äá»c HÆ°á»›ng Dáº«n!", 5)
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("  ğŸ”¬ DungeonX Deep Spy Tool v2.0")
print("  Made by HCT")
print("  Capabilities:")
print("    hookmetamethod: " .. tostring(SpyState.HasHookMeta))
print("    getgc: " .. tostring(SpyState.HasGetGC))
print("    debug: " .. tostring(SpyState.HasDebug))
print("    getnilinstances: " .. tostring(SpyState.HasNilInst))
print("  Right Ctrl = Toggle visibility")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
